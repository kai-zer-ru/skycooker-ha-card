# SkyCooker Card

**Карточка для управления мультиваркой SkyCooker в Home Assistant**

## Описание

Эта карточка предоставляет удобный интерфейс для управления мультиваркой (https://github.com/kai-zer-ru/skycooker-ha)[SkyCooker] через Home Assistant. Карточка имеет компактный дизайн, вдохновленный lovelace-mushroom, и поддерживает все функции мультиварки, включая управление режимами, временем приготовления, отложенным стартом, автоподогревом и температурой.

## Возможности

### Управление режимами работы
Карточка позволяет выбирать основные и дополнительные режимы приготовления. Доступные режимы включают:
- Мультиповар
- Выпечка
- Гриль
- Пароварка
- Жарка
- Тушение
- Разогрев
- Йогурт
- Молочная каша
- Каша
- Суп
- Жарка на воздухе
- Ферментация
- Пастеризация
- Сушка

### Управление временем приготовления
Позволяет устанавливать время приготовления в часах и минутах. Время отображается в формате ЧЧ:ММ и может быть изменено с помощью выпадающих списков.

### Отложенный старт
Позволяет настроить время отложенного запуска приготовления. Время отложенного старта устанавливается в часах и минутах и отображается в интерфейсе.

### Автоподогрев
Функция автоподогрева позволяет поддерживать температуру блюда после завершения приготовления. Включается и отключается с помощью переключателя.

### Контроль температуры
Карточка поддерживает отображение и установку температуры приготовления. Температура может быть установлена с помощью сущности `cooking_temperature_entity`, что позволяет точно настроить процесс приготовления.

### Контроль состояния
Отображает текущую температуру, оставшееся время, общее время и статус приготовления. Статус может быть одним из следующих:
- Разогрев
- Готовка
- Подогрев
- Отложенный старт
- Ожидание

### Прогресс приготовления
Визуальное отображение прогресса приготовления в виде прогресс-бара. Прогресс-бар автоматически скрывается для неактивных статусов и отображается только для статусов "Разогрев" и "Готовка".

### Многоязычный интерфейс
Карточка поддерживает русский и английский языки. Язык интерфейса автоматически определяется из настроек Home Assistant.

### Компактный дизайн
Современный интерфейс, вдохновленный lovelace-mushroom, с улучшенной пользовательской опыт. Особенности:
- Компактный заголовок
- Улучшенная визуализация
- Компактные элементы управления
- Сворачиваемые дополнительные настройки
- Круглые кнопки действий
- Адаптивная сетка
- Улучшенные стили

### Избранные режимы
Поддержка сущности `favorite_modes_entity` для отображения избранных режимов. Если эта сущность настроена, в интерфейсе появляются вкладки для переключения между избранными и всеми режимами. Это позволяет пользователю быстро выбирать часто используемые режимы.

### Дополнительные функции
- **Сенсоры времени**: отображение времени отложенного старта и автоподогрева
- **Подписи в селектах**: улучшенная доступность и понятность интерфейса
- **Красивые селекты времени**: закругленные углы, компактный размер, тени и плавные переходы для всех селектов

## Установка

### Через HACS (рекомендуется)

1. Добавьте этот репозиторий в HACS:
   - Перейдите в HACS > Интеграции
   - Нажмите на три точки в правом верхнем углу
   - Выберите "Пользовательские репозитории"
   - Добавьте `https://github.com/kai-zer-ru/skycooker-ha-card` как репозиторий типа "Lovelace"
   - Нажмите "Добавить"

2. Установите карточку:
   - Перейдите в HACS > Frontend
   - Найдите "SkyCooker Card" и нажмите "Установить"

### Вручную

1. Скачайте последний релиз с GitHub
2. Скопируйте файл `skycooker-ha-card.js` из папки `dist` в директорию `www` вашего Home Assistant
3. Добавьте карточку в ваши ресурсы:
   ```yaml
   resources:
     - url: /local/skycooker-ha-card.js
       type: module
   ```

## Конфигурация

Минимальная конфигурация карточки:

```yaml
type: custom:skycooker-ha-card
name: SkyCooker
icon: mdi:stove
language: ru
```

Полная конфигурация с всеми параметрами:

```yaml
type: custom:skycooker-ha-card
name: SkyCooker
icon: mdi:stove
language: ru
mode_entity: select.skycooker_mode
additional_mode_entity: select.skycooker_additional_mode
cooking_time_hours_entity: select.skycooker_cooking_time_hours
cooking_time_minutes_entity: select.skycooker_cooking_time_minutes
delayed_start_hours_entity: select.skycooker_delayed_start_hours
delayed_start_minutes_entity: select.skycooker_delayed_start_minutes
auto_warm_entity: switch.skycooker_auto_warm
start_entity: button.skycooker_start
stop_entity: button.skycooker_stop
start_delayed_entity: button.skycooker_start_delayed
temperature_entity: sensor.skycooker_temperature
cooking_temperature_entity: select.skycooker_cooking_temperature
remaining_time_entity: sensor.skycooker_remaining_time
cooking_time_entity: sensor.skycooker_cooking_time
status_entity: sensor.skycooker_status
current_mode_entity: sensor.skycooker_current_mode
current_additional_mode_entity: sensor.skycooker_current_additional_mode
auto_warm_time_entity: sensor.skycooker_auto_warm_time
delayed_launch_time_entity: sensor.skycooker_delayed_launch_time
favorite_modes_entity: select.skycooker_favorite_modes
```

## Параметры конфигурации

| Параметр | Тип | Обязательно | Описание |
|----------|-----|-------------|-----------|
| type | string | Да | Тип карточки: `custom:skycooker-ha-card` |
| name | string | Нет | Имя карточки (по умолчанию: "SkyCooker") |
| icon | string | Нет | Иконка карточки (по умолчанию: "mdi:stove") |
| language | string | Нет | Язык интерфейса (по умолчанию: "ru") |
| mode_entity | string | Нет | Сущность для выбора режима работы. Отвечает за основные режимы приготовления, такие как "Мультиповар", "Выпечка", "Гриль" и другие. |
| additional_mode_entity | string | Нет | Сущность для выбора дополнительного режима. Используется для дополнительных настроек режима приготовления. |
| cooking_time_hours_entity | string | Нет | Сущность для выбора часов времени приготовления. Позволяет установить количество часов для приготовления. |
| cooking_time_minutes_entity | string | Нет | Сущность для выбора минут времени приготовления. Позволяет установить количество минут для приготовления. |
| delayed_start_hours_entity | string | Нет | Сущность для выбора часов отложенного старта. Позволяет установить количество часов для отложенного старта. |
| delayed_start_minutes_entity | string | Нет | Сущность для выбора минут отложенного старта. Позволяет установить количество минут для отложенного старта. |
| auto_warm_entity | string | Нет | Сущность для управления автоподогревом. Включает или отключает функцию автоподогрева после завершения приготовления. |
| start_entity | string | Нет | Сущность для кнопки старта. Запускает процесс приготовления с текущими настройками. |
| stop_entity | string | Нет | Сущность для кнопки остановки. Останавливает процесс приготовления и сбрасывает текущий режим. |
| start_delayed_entity | string | Нет | Сущность для кнопки отложенного старта. Запускает процесс приготовления с задержкой, установленной в `delayed_start_hours_entity` и `delayed_start_minutes_entity`. |
| temperature_entity | string | Нет | Сущность для отображения текущей температуры. Показывает текущую температуру внутри мультиварки. |
| cooking_temperature_entity | string | Нет | Сущность для выбора температуры приготовления. Позволяет установить желаемую температуру для приготовления. Эта сущность используется для точной настройки температуры в режимах, где это возможно. |
| remaining_time_entity | string | Нет | Сущность для отображения оставшегося времени приготовления. Показывает, сколько времени осталось до завершения процесса. |
| cooking_time_entity | string | Нет | Сущность для отображения общего времени приготовления. Показывает общее время, установленное для приготовления. |
| status_entity | string | Нет | Сущность для отображения текущего статуса мультиварки. Может принимать значения, такие как "Разогрев", "Готовка", "Подогрев", "Отложенный старт" и другие. |
| current_mode_entity | string | Нет | Сущность для отображения текущего режима приготовления. Показывает, какой режим в данный момент активен. |
| current_additional_mode_entity | string | Нет | Сущность для отображения текущего дополнительного режима. Показывает дополнительные настройки текущего режима. |
| auto_warm_time_entity | string | Нет | Сущность для отображения времени автоподогрева. Показывает, сколько времени осталось до завершения автоподогрева. |
| delayed_launch_time_entity | string | Нет | Сущность для отображения времени отложенного старта. Показывает, сколько времени осталось до начала отложенного старта. |
| favorite_modes_entity | string | Нет | Сущность для отображения избранных режимов. Позволяет пользователю быстро выбирать часто используемые режимы. Если эта сущность настроена, в интерфейсе появляются вкладки для переключения между избранными и всеми режимами. |

## Примеры использования

### Минимальная конфигурация

```yaml
type: custom:skycooker-ha-card
name: Моя мультиварка
icon: mdi:pot-mixer
language: ru
mode_entity: select.skycooker_mode
start_entity: button.skycooker_start
stop_entity: button.skycooker_stop
temperature_entity: sensor.skycooker_temperature
```

### Полная конфигурация

```yaml
type: custom:skycooker-ha-card
name: SkyCooker Pro
icon: mdi:stove
temperature_entity: sensor.skycooker_temperature
remaining_time_entity: sensor.skycooker_remaining_time
total_time_entity: sensor.skycooker_total_time
status_entity: sensor.skycooker_status
current_mode_entity: sensor.skycooker_current_mode
mode_entity: select.skycooker_mode
additional_mode_entity: select.skycooker_additional_mode
cooking_time_hours_entity: select.skycooker_cooking_time_hours
cooking_time_minutes_entity: select.skycooker_cooking_time_minutes
delayed_start_hours_entity: select.skycooker_delayed_start_hours
delayed_start_minutes_entity: select.skycooker_delayed_start_minutes
auto_warm_entity: switch.skycooker_auto_warm
start_entity: button.skycooker_start
stop_entity: button.skycooker_stop
start_delayed_entity: button.skycooker_start_delayed
cooking_temperature_entity: select.skycooker_cooking_temperature
auto_warm_time_entity: sensor.skycooker_auto_warm_time
delayed_launch_time_entity: sensor.skycooker_delayed_launch_time
favorite_modes_entity: select.skycooker_favorite_modes
```

## Внешний вид

Современный, компактный дизайн с улучшенной пользовательской опыт, вдохновленный популярным lovelace-mushroom. Особенности:

- **Компактный заголовок**: меньший размер, больше информации
- **Улучшенная визуализация**: прогресс-бар с процентным отображением
- **Компактные элементы управления**: оптимизированное расположение
- **Сворачиваемые дополнительные настройки**: экономия места на экране
- **Круглые кнопки действий**: современный дизайн с эффектами наведения
- **Адаптивная сетка**: лучше подходит для мобильных устройств
- **Улучшенные стили**: современные тени, скругленные углы, градиенты
- **Умный прогресс-бар**: автоматически скрывается для неактивных статусов
- **Сенсоры времени**: отображение времени отложенного старта и автоподогрева
- **Подписи в селектах**: улучшенная доступность и понятность интерфейса
- **Красивые селекты времени**: закругленные углы, компактный размер, тени и плавные переходы для всех селектов

## Скриншоты

### Классический внешний вид (избранные режимы)

![Классический внешний вид (избранные режимы)](img/1.png)
*Интерфейс с вкладкой "Избранные режимы", где отображаются только часто используемые режимы.*

### Классический внешний вид (все режимы)

![Классический внешний вид (все режимы)](img/2.png)
*Интерфейс с вкладкой "Все режимы", где отображаются все доступные режимы приготовления.*

### Расширенный внешний вид

![Расширенный внешний вид](img/3.png)
*Расширенный интерфейс с дополнительными настройками, такими как температура, время приготовления и отложенный старт.*

## Устранение неполадок

### Карточка не отображается

1. Проверьте, что файл `skycooker-ha-card.js` находится в правильной директории
2. Убедитесь, что ресурс добавлен в конфигурацию Home Assistant
3. Проверьте, что тип карточки указан правильно: `custom:skycooker-ha-card`
4. Очистите кэш браузера и перезагрузите страницу

### Карточка отображается, но не работает

1. Проверьте, что все указанные сущности существуют в вашей системе Home Assistant
2. Убедитесь, что имена сущностей написаны правильно
3. Проверьте, что сущности доступны и имеют правильные состояния
4. Проверьте логи браузера на наличие ошибок (F12 > Console)

### Сообщение "Не настроено"

Это сообщение появляется, если ни одна сущность не указана в конфигурации. Добавьте хотя бы одну сущность для отображения состояния.

### Проблемы с выбором режимов

Если режимы не выбираются или не отображаются правильно:

1. Откройте консоль браузера (F12 > Console)
2. Проверьте логи, которые начинаются с:
   - "Setting config:" - информация о конфигурации
   - "Mode buttons - Entity ID:" - информация о доступных режимах
   - "Has "На пару" option:" - наличие конкретного режима
   - "Setting mode:" - вызов сервиса для установки режима
3. Убедитесь, что:
   - Сущность `mode_entity` правильно указана в конфигурации
   - Опция "На пару" присутствует в атрибутах сущности `mode_entity`
   - Опция "На пару" не фильтруется (не входит в список: 'Нет', 'Режим ожидания', 'None', 'Standby Mode')
   - Сервис `select.select_option` вызывается с правильными параметрами

### Диагностика через логи

Карточка выводит подробные логи в консоль браузера для диагностики проблем:

- Информация о конфигурации при её установке
- Список всех доступных опций для сущности режима
- Наличие опции "На пару" до и после фильтрации
- Параметры вызова сервиса select.select_option при нажатии на кнопку режима

Для просмотра логов откройте консоль браузера (F12 > Console) и выполните действия, которые вызывают проблему.

## Разработка

### Требования

- Node.js версии 18 или выше
- npm или yarn

### Установка зависимостей

```bash
npm install
```

### Сборка проекта

```bash
npm run build
```

### Разработка с автоматической перезагрузкой

```bash
npm run dev
```

### Структура проекта

- `src/skycooker-ha-card.ts` - основной файл карточки
- `src/skycooker-ha-card-editor.ts` - редактор конфигурации
- `src/localize.ts` - локализация
- `src/const.ts` - константы (версия карточки)
- `src/translations/` - файлы переводов
- `dist/skycooker-ha-card.js` - собранный файл (результат)

## Локализация

Карточка поддерживает несколько языков и автоматически определяет язык интерфейса из настроек Home Assistant.

### Поддерживаемые языки

- Русский (ru) - основной язык
- Английский (en)

### Добавление нового языка

1. Создайте новый файл JSON в `src/translations/` (например, `de.json` для немецкого)
2. Скопируйте структуру из `en.json` и переведите все значения
3. Добавьте новый язык в `src/localize.ts`
4. Соберите проект: `npm run build`

## Лицензия

Этот проект лицензирован под лицензией MIT. Подробности смотрите в файле LICENSE.